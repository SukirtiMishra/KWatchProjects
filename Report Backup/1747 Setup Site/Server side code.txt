Imports kWHTML
Imports kWHTML.Elements
Imports WebManagement
Imports kWHTML.kWForms
Imports kWatchServer.usrUsers

Namespace kWatchServer.tskTasks
    ''' <summary>"
    ''' Define all custom code for this assembly within this class 
    ''' </summary>
    ''' <remarks></remarks>
    Public Class WEB_tskSetUpSite
        Implements WebForm

#Region "Public Variables"
        Public CSSInclude
        Public FirstColWidth
        Private prvMainTaskFormName
        Private prvTaskCurrentStatus
#End Region
#Region "Enum Section"
        Public Enum EnPressFor
            EMA = 1
            LetterOfAuthority = 2
            CurrentContract = 3
            MeteringAgreement = 4
        End Enum

#End Region
        ' ''' <summary>
        ' ''' Example - This can be used as a report property - note the <reportProperty>  attribute that has been applied
        ' ''' </summary>
        ' ''' <value></value>
        ' ''' <returns></returns>
        ' ''' <remarks></remarks>
        '<reportProperty>
        'Public Property SiteID As Integer

        ''' <summary>
        ''' Main function that is returned to the lines of the report when it is ran
        ''' </summary>
        ''' <param name="html"></param>
        ''' <remarks></remarks>
        Public Sub GetReport(html As HTMLTextWriterkWatch) Implements WebForm.GetReport
            Dim repBase = GetReportBase()
            repBase.ToString(html)
        End Sub
        Public Function GetReportBase() As HTMLkWFormBase Implements WebForm.GetReportBase
            Dim Form = HTMLkWFormBase.Create(Me)
            Form.onLoadFormBase = "onLoadFormBase1747"
            Form.JScript.Add(My.Resources.ClientScript)
            GetAllControlsSetUpSite(Form)
            Form.ScriptFunctionCallCodeObjectAdd(Function(c) c.ReturnAddSubTaskForSteps(Nothing))
            Form.ScriptFunctionCallCodeObjectAdd(Function(c) c.ReturnOpenTaskStatusTable(Nothing))
            Form.ScriptFunctionCallCodeObjectAdd(Function(c) c.ReturnOpenItemReportFile(Nothing))
            Return Form
        End Function
        Public Sub GetAllControlsSetUpSite(form As HTMLkWFormBase(Of WEB_tskSetUpSite))
            Dim TaskNote = kWHTMLElementInputText.CreateDirect(Me, "Task_Note", MyBase.Task_Note, "Task_Note")
            form.FormSectionMain.Add("Note", TaskNote)
            ' form.FormSectionMain.Add(New HTMLElementDIV(Res.ToString))
            If GetEMA.ToString <> "" Then
                form.FormSectionMain.Add("EMA", New HTMLElementDIV(GetEMA.ToString))
            End If
            If GetLetterOfAuthority() <> "" Then
                form.FormSectionMain.Add("Letter Of Authority", New HTMLElementDIV(GetLetterOfAuthority.ToString))
            End If
            If GetCurrentContract.ToString <> "" Then
                form.FormSectionMain.Add("Current Contract", New HTMLElementDIV(GetCurrentContract.ToString))
            End If
            If GetMeteringAgreement.ToString <> "" Then
                form.FormSectionMain.Add("Metering Agreement", New HTMLElementDIV(GetMeteringAgreement.ToString))
            End If
            Dim TaskStatusTable As New HTMLElementDIV(GetTaskCurrentStatus.ToString)
            form.FormSectionMain.Add("Task Status", New HTMLElementDIV(IsNotReadyReasonTaskCurrentStatus))
            form.FormSectionMain.Add(New HTMLElementDIV(NoteFiles.ToString))
            form.FormSectionMain.Add(New HTMLElementDIV(GetTaskSteps.ToString))
        End Sub
        Public Function Res()
            With Me.User.Reports_Definitions.Item_By_Name("HTML_tskTaskGlobal").ClassObject
                With .CodeObject
                    .SetDefaults
                    .Task = Me
                    .MainTask = MainTask
                    .IncludeTaskFor = True
                    .IncludeFollowUp = True
                    .IncludeTaskContacts = True
                End With
                Return .EvaluateAsText(False)
            End With
        End Function
        Public Function NoteFiles()
            With Me.User.Reports_Definitions.Item_By_Name("HTML_tskTaskGlobal").ClassObject
                With .CodeObject
                    .SetDefaults
                    .Task = Me
                    .MainTask = MainTask
                    .IncludeNotes = True
                    .IncludeFiles = True
                End With
                Return .EvaluateAsText(False)
            End With
        End Function
        Public Function ReturnOpenTaskStatusTable(id) As kWControlEventReturnInfo
            Try
                If id IsNot Nothing Then
                    Dim tsk As tskTask = Me.User.Get_Item_Object("57~" & id).ClassObject
                    Dim ReportInfo As Object = New Dynamic.ExpandoObject
                    ReportInfo.targetReportGuid = CType(tsk.Reports_Definitions.Item_By_Name("LOCALHTML_" & TypeName(tsk)).ClassObject, defRun_Report_Definition).RunReportGUID ' "43567d47-b760-4c5a-b527-b9b702540a19"
                    ReportInfo.targetReportPropertiesGuid = Nothing '"{}"
                    Return New kWControlEventReturnInfo With {.success = True, .returnData = ReportInfo}
                Else
                    Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "We Do Not Find Task ID Related To This file "}
                End If
            Catch ex As Exception
                Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "Failed Due To:" & ex.Message.ToString}
            End Try
        End Function
        Public Function ReturnAddSubTaskForSteps(id) As kWControlEventReturnInfo
            Try
                If id IsNot Nothing Then
                    Dim Rep As tskTask = Me.User.Get_Item_Object("57~" & id).ClassObject
                    Dim ReportInfo As Object = New Dynamic.ExpandoObject
                    ReportInfo.targetReportGuid = CType(Rep.SubTasks.Reports_Definitions.Item_By_Name("LOCALHTMLADD_KWItems").ClassObject, defRun_Report_Definition).RunReportGUID ' "43567d47-b760-4c5a-b527-b9b702540a19"
                    ReportInfo.targetReportPropertiesGuid = Nothing
                    Return New kWControlEventReturnInfo With {.success = True, .returnData = ReportInfo}
                Else
                    Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "We Do Not ID Related To This file "}
                End If
            Catch ex As Exception
                Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "Failed Due To:" & ex.Message.ToString}
            End Try
        End Function
        Public Function IsNotReadyReasonTaskCurrentStatus() As kWTables.kWTable
            Dim WarnIcon As String
            Dim ItemIsNotReadyReasonList As New List(Of ClsIsNotReadyReasonTable)
            WarnIcon = "EventLog_Warning.png"
            Dim I = 0
            Dim ArrListTaskStatus = TaskCurrentStatus()
            For Each Reason In ArrListTaskStatus
                I += 1
                If Not Reason.Referance Is Nothing Then
                    Dim ObjHTML_repManageIsNotReady As New HTML_repManageIsNotReady
                    ItemIsNotReadyReasonList.Add(New ClsIsNotReadyReasonTable With
                                             {
                                             .ID = I,
                                             .Image = "<IMG Width=16px Height=16px  src='../icons/" & WarnIcon & "'>",
                                             .ReferenceIcon = "<IMG Width=16px Height=16px  src='../iconsBMP/" & Reason.Referance.Icon & ".bmp'>",
                                             .Problem = Reason.Reason,
                                             .ReasonCode = ObjHTML_repManageIsNotReady.GetIsNotReadyName(Reason.Problem),
                                             .FurtherInfo = Reason.FurtherInformation,
                                             .PathLink = Reason.Referance.ID
                                             })
                End If
            Next
            Dim TblIsNotReadyreasonCode = kWHTML.kWTables.kWTable.Create(Me, "TblIsNotReadyreasonCode", ItemIsNotReadyReasonList, "")
            TblIsNotReadyreasonCode.AddColumn("Image", Function(c) c.Image)
            TblIsNotReadyreasonCode.AddColumn("", Function(c) c.ReferenceIcon)
            TblIsNotReadyreasonCode.AddColumn("Problem", Function(c) c.Problem)
            TblIsNotReadyreasonCode.AddColumn("ReasonCode", Function(c) c.ReasonCode)
            TblIsNotReadyreasonCode.AddColumn("FurtherInfo", Function(c) c.FurtherInfo)
            TblIsNotReadyreasonCode.AddColumn("Open Task", Function(c) New HTMLElementDIV(OpenTaskStatusTable(c.PathLink)))
            'OpenTask
            Return TblIsNotReadyreasonCode
        End Function
        Public Function OpenTaskStatusTable(id) As HTMLElementDIV
            Dim DivOpenTable As New HTMLElementDIV
            Dim BtnOpenTask = kWHTMLElementButton.Create(Me, "BtnOpenTask")
            Dim props As Object = New Dynamic.ExpandoObject
            props.ItemID = id
            BtnOpenTask.userObject = props
            BtnOpenTask.ButtonText.Text = " <i class='fas fa-file-code'></i> "
            BtnOpenTask.ButtonStyle = kWHTMLElementButton.buttonStyles.nothing
            BtnOpenTask.onClickEvent.onAfterTriggerFunctionName = "OpenTaskStatusTableClick"
            DivOpenTable.Controls.Add(BtnOpenTask)
            Return DivOpenTable
        End Function
        Public Function AddSubTaskFor(id) As HTMLElementDIV
            Dim division As New HTMLElementDIV
            Dim AddSubTaskButton = kWHTMLElementButton.Create(Me, "Add Sub Task")
            Dim props As Object = New Dynamic.ExpandoObject
            props.tdtto = id
            AddSubTaskButton.userObject = props
            AddSubTaskButton.onClickEvent.onAfterTriggerFunctionName = "AddSubTaskForButtonClick"
            division.Controls.Add(AddSubTaskButton)
            Return division
        End Function
        Public Function GetTaskSteps()
            If Me.SubTasks.Count > 0 Then
                Return Me.Reports_Definitions.Item_By_Name(CStr(prvMainTaskFormName)).ClassObject.CodeObject.GetTaskSteps
            Else
                Return "<SPAN ID=SubTasksSpan>There are no Sub tasks - <SPAN CLASS " & AddSubTaskFor(Me.ID).ToString
            End If
        End Function
        Public Function GetTaskCurrentStatus()
            With Me.User.Reports_Definitions.Item_By_Name("HTML_repManageIsNotReady").ClassObject.CodeObject
                .SetDefaults
                .IsNotReadyReasons = TaskCurrentStatus()
                .CurrentReport = Me
                'Set the Properties and settings for the report
                .IsNotReadyReasonSizeLimit = 0
                .IsNotReadyReasonShowLinks = True
                .LayoutForTasks = True
                'Return the results
                If .IsNotReadyReason IsNot Nothing Then
                    Return .IsNotReadyReason
                Else
                    Return ""
                End If
            End With
        End Function
        Public Function TaskCurrentStatus()
            prvTaskCurrentStatus = CreateObject("kWatchServer.isrNotReadyStates")
            If Me.ReferenceFile Is Nothing Then
                'This means there is not file here currently
                prvTaskCurrentStatus.Add(Me.LongID, 200, "No file has been linked - please link the email/letter that was obtained", Me.User)
            End If
            Return prvTaskCurrentStatus
        End Function
        Public Function ReturnOpenItemReportFile(id) As kWControlEventReturnInfo
            Try
                If id IsNot Nothing Then
                    Dim tsk As filFile = Me.User.Get_Item_Object("32~" & id.ToString).ClassObject
                    Dim ReportInfo As Object = New Dynamic.ExpandoObject
                    ReportInfo.targetReportGuid = CType(tsk.Reports_Definitions.Item_By_Name("LOCALHTML_" & TypeName(tsk)).ClassObject, defRun_Report_Definition).RunReportGUID ' "43567d47-b760-4c5a-b527-b9b702540a19"
                    ReportInfo.targetReportPropertiesGuid = Nothing '"{}"
                    Return New kWControlEventReturnInfo With {.success = True, .returnData = ReportInfo}
                Else
                    Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "We Do Not Find ID Related To This file "}
                End If
            Catch ex As Exception
                Return New kWControlEventReturnInfo With {.success = False, .returnMessage = "Failed Due To:" & ex.Message.ToString}
            End Try
        End Function
        Public Function GetItemForMe(ID As String, EnFor As EnPressFor) As HTMLElementDIV
            Dim EvBef = ""
            Dim EvAft = ""
            Dim Idfor = Nothing
            Dim DivControls As New HTMLElementDIV
            If EnFor = EnPressFor.EMA Then
                Idfor = "EMA"
                EvAft = "EMAAfterClick"
            ElseIf EnFor = EnPressFor.LetterOfAuthority Then
                Idfor = "LetterOfAuthority"
                EvAft = "LetterOfAuthorityClicked"
            ElseIf EnFor = EnPressFor.CurrentContract Then
                Idfor = "CurrentContract"
                EvAft = "CurrentContractClicked"
            ElseIf EnFor = EnPressFor.MeteringAgreement Then
                Idfor = "MeteringAgreement"
                EvAft = "MeteringAgreementClicked"
            End If
            Dim PropExpObj As Object = New Dynamic.ExpandoObject
            PropExpObj.ItemID = ID
            Dim BtnOpn = kWHTMLElementButton.Create(Me, "")
            BtnOpn.userObject = PropExpObj
            BtnOpn.ButtonText.Text = "Â <i class='fas fa-file-code'></i>"
            BtnOpn.ButtonStyle = kWHTMLElementButton.buttonStyles.success
            BtnOpn.onClickEvent.onAfterTriggerFunctionName = EvAft
            DivControls.Controls.Add(BtnOpn)
            Return DivControls
        End Function
        Public Function GetEMA()
            Dim result
            Dim Company = Nothing
            If Not Me.OwnerItem Is Nothing Then
                If Me.OwnerItem.ClassType = utlClassType.utlClassTypesitSite Then
                    Company = Me.OwnerItem.ClassObject.Company
                ElseIf Me.OwnerItem.ClassType <> (utlClassType.utlClassTypesitSite) Then
                    Company = Nothing
                End If
            End If
            If Not Company Is Nothing Then
                If Company.Monthly_Report_Agreement IsNot Nothing Then
                    'InitialName = Me.Authorisation_letter.Name
                    'InitialIcon = Me.Authorisation_letter.Icon		
                    Dim EMAid = Company.Monthly_Report_Agreement.LongID
                    Dim IDFor = Split(EMAid, "~")
                    result = Company.Monthly_Report_Agreement.Name & GetItemForMe(IDFor(1).ToString, EnPressFor.EMA).ToString
                Else
                    result = "No EMA"
                End If
            Else
                result = ""
            End If
            Return result
        End Function
        Public Function EMA()
            Dim EMAStr
            Dim ResStr
            EMAStr = "<TR><TD><B>EMA</B></TD><TD>"
            ResStr = GetEMA()
            If Not Len(ResStr) = 0 Then
                EMAStr = EMAStr & ResStr & "</TD></TR>"
            Else
                EMAStr = ""
            End If
            Return EMAStr
        End Function
        Public Function GetMeteringAgreement()
            Dim result
            Dim Site
            If Not Me.OwnerItem Is Nothing Then
                If Me.OwnerItem.ClassType = utlClassType.utlClassTypesitSite Then
                    Site = Me.OwnerItem.ClassObject
                ElseIf Me.OwnerItem.ClassType <> (utlClassType.utlClassTypesitSite) Then
                    Site = Nothing
                End If
            End If
            If Not Site Is Nothing Then
                If Not Site.Metering_Agreement Is Nothing Then
                    Dim ItemsID = Site.Metering_Agreement.LongID
                    Dim IDFor = Split(ItemsID, "~")
                    result = Site.Metering_Agreement.Name & " <B>Created On: </B>" & Site.Metering_Agreement.Date_Created & GetItemForMe(IDFor(1).ToString, EnPressFor.MeteringAgreement).ToString
                Else
                    result = "No Agreement"
                End If
            Else
                result = ""
            End If
            Return result
        End Function
        Public Function MeteringAgreement()
            Dim MAStr
            Dim ResStr
            MAStr = "<TR><TD><B>Metering Agreement</B></TD><TD>"
            ResStr = GetMeteringAgreement()
            If Not Len(ResStr) = 0 Then
                MAStr = MAStr & ResStr '& "</TD></TR>"
            Else
                MAStr = ""
            End If
            Return MAStr
        End Function
        Public Function GetLetterOfAuthority()
            Dim result
            Dim Company
            Dim DefaultName
            Dim InitialName
            Dim InitialIcon
            If Not Me.OwnerItem Is Nothing Then
                If Me.OwnerItem.ClassType = utlClassType.utlClassTypesitSite Then
                    Company = Me.OwnerItem.ClassObject.Company
                ElseIf Me.OwnerItem.ClassType <> (utlClassType.utlClassTypesitSite) Then
                    Company = Nothing
                End If
            End If
            If Not Company Is Nothing Then
                If Not Company.Authorisation_letter Is Nothing Then
                    'InitialName = Me.Authorisation_letter.Name
                    'InitialIcon = Me.Authorisation_letter.Icon	
                    Dim ItemID = Company.Authorisation_letter.LongID
                    Dim IDFor = Split(ItemID, "~")
                    result = Company.Authorisation_letter.Name & " <B>Signed On: </B>" & Company.AuthorisedSignedDate & GetItemForMe(IDFor(1).ToString, EnPressFor.LetterOfAuthority).ToString
                Else
                    result = "No Agreement"
                End If
            Else
                result = ""
            End If
            Return result
        End Function
        Public Function LetterOfAuthority()
            Dim LOAStr
            Dim ResStr
            LOAStr = "<TR><TD><B>Letter of Authority</B></TD><TD>"
            ResStr = GetLetterOfAuthority()
            If Not Len(ResStr) = 0 Then
                LOAStr = LOAStr & ResStr & "</TD></TR>"
            Else
                LOAStr = ""
            End If
            Return LOAStr
        End Function

        Public Function GetCurrentContract()
            Dim result
            Dim Site
            If Not Me.OwnerItem Is Nothing Then
                If Me.OwnerItem.ClassType = utlClassType.utlClassTypesitSite Then
                    Site = Me.OwnerItem.ClassObject
                ElseIf Me.OwnerItem.ClassType <> (utlClassType.utlClassTypesitSite) Then
                    Site = Nothing
                End If
            End If
            If Not Site Is Nothing Then
                If Not Site.Electricity_Supply_Agreement Is Nothing Then
                    If Not Site.CurrentPricing Is Nothing Then
                        If Not Site.CurrentPricing.ContractAgreementFile Is Nothing Then
                            If Not Site.Electricity_Supply_Agreement_ID = Site.CurrentPricing.ContractAgreementFile_ID Then
                                Site.Electricity_Supply_Agreement_ID = Site.CurrentPricing.ContractAgreementFile_ID
                            End If
                        End If
                    End If
                    Dim SplitedID As String = Site.Electricity_Supply_Agreement.LongID
                    Dim IDFor = Split(SplitedID, "~")
                    result = Site.Electricity_Supply_Agreement.Name & " <B>Expiry Date: </B>" & Site.RetailAgreementExpiryDate & GetItemForMe(IDFor(1).ToString, EnPressFor.CurrentContract).ToString
                Else
                    result = "No Agreement"
                End If
            Else
                result = ""
            End If
            Return result
        End Function
        Public Function CurrentContract()
            Dim CCStr
            Dim ResStr
            CCStr = "<TR><TD><B>Current Contract</B></TD><TD >"
            ResStr = GetCurrentContract()
            If Not Len(ResStr) = 0 Then
                CCStr = CCStr & ResStr & "</TD></TR>"
            Else
                CCStr = ""
            End If
            Return CCStr
        End Function


        ''' <summary>
        ''' This is the function that is called when you need to refresh the form base object
        ''' </summary>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Function RefreshFormBase() As String Implements WebForm.RefreshFormBase

            'Get the report
            Dim repBase As HTMLkWFormBase(Of WEB_tskSetUpSite) = GetReportBase()
            'This will exclude the jscript code and other items
            repBase.RefreshPageCall = True
            Dim html As New HTMLTextWriterkWatch
            repBase.ToString(html)
            'Return the string that contains the main contents of this report with extras
            Return html.ToString

        End Function

#Region "Default Code"

        <ThreadStatic()>
        Public Shared SharedMe As WEB_tskSetUpSite

        'Private _Entities As Entities
        '''' <summary>
        '''' This should only be used when updating properties, not in any other code - when you need the entities you should
        '''' create it yourself
        '''' </summary>
        '''' <value></value>
        '''' <returns></returns>
        '''' <remarks></remarks>
        'Public ReadOnly Property Entities As Entities
        '    Get
        '        If Not _Entities Is Nothing Then
        '            If _Entities.IsDisposed Then
        '                _Entities = Nothing
        '            End If
        '        End If
        '        If _Entities Is Nothing Then
        '            _Entities = New Entities(Me.User)
        '        End If

        '        Return _Entities
        '    End Get
        'End Property


        ''' <summary>
        ''' This can be used to associate an icon with this report that is different to the underlying report
        ''' You could set this within the SetDefaults, or you could create a get and set componet of the 
        ''' property and override it
        ''' </summary>
        ''' <returns></returns>
        Public Property ReportIcon As Icons Implements WebForm.ReportIcon

        ''' <summary>
        ''' Initialization code in here for this report.  This code will be called each time the report is ran
        ''' other call reports should also call this before using the report output or any contained functions
        ''' </summary>
        ''' <remarks></remarks>
        Public Sub SetDefaults() Implements defReport_Definitions.defReportDefinitionBase.SetDefaults
            'ItemReferance = LCase("User.Get_Item_Object(~!~" & Me.LongID & "~!~, True).ClassObject")
            CSSInclude = True
            FirstColWidth = ""
            prvMainTaskFormName = Me.User.Reports_Definitions.Item_By_Name("HTML_tskTaskGlobal").ClassObject.CodeObject.MainTaskFormName


            SharedMe = Me
        End Sub

        ''' <summary>
        ''' This is a callback that is called after the report if produced.  The report is a document of type Word, Excel, Email or RTF
        ''' This depends on the type of report produced
        ''' </summary>
        ''' <param name="ReportObj">The Report object</param>
        ''' <remarks></remarks>
        Public Sub AfterReportProduce(ByVal ReportObj As Object) Implements defReport_Definitions.defReportDefinitionBase.AfterReportProduce
        End Sub

        ''' <summary>
        ''' The callback is called after the file has been saved to kWatch.  The file object is a referances to the filFile object that has 
        ''' just been saved
        ''' </summary>
        ''' <param name="File">The newly saved file</param>
        ''' <remarks></remarks>
        Public Sub AfterFileSave(ByVal File As kWatchServer.filFile) Implements defReport_Definitions.defReportDefinitionBase.AfterFileSave
        End Sub


        ''' <summary>
        ''' This is the web request object that has been passed back from the originating call. This contains
        ''' information relating to the browser, the call been made and the IIS server that the call came from.
        ''' This is a copy of the request object that is generated by the server 
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Property Request As UserRequest Implements WebForm.Request

        ''' <summary>
        ''' This is the WebSite that this request belongs to
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Property Web As webWebSite Implements WebForm.Web

        ''' <summary>
        ''' This is the webContact that relatest to this request
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Property WebContact As webContactLogin Implements WebForm.WebContact

#Region "Settings"

        ''' <summary>
        ''' This will return the settings object as a dynamic expando object that you can review and edit.  If you
        ''' want your settings object casted to a specific type, use the GetSettings function.  Setting an object
        ''' to this location will also update the settings object for you as well
        ''' 
        ''' This will get the settings object for this report object.  Settings objects are unique based on
        ''' the RunReportID, LoggedInContact (either web or local), The active WebID or web site, a DashboardwidgetID and
        ''' optionaly a SettingsLocationID that you might choose to use.
        ''' 
        ''' So for a kWatch report delivered within kWatch - this would be unique based on RunReportID and contactID only as
        ''' webID, DashboardwidgetID and SettinglocationID are all nothing
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Property Settings As Object Implements WebForm.Settings
            Get
                Return WebManagement.SettingsManagement.GetSettings(Me) ' Newtonsoft.Json.JsonConvert.DeserializeObject(Of ExpandoObject)(Me.SettingsRecord.SettingsObject)
            End Get
            Set(value As Object)
                WebManagement.SettingsManagement.SaveSettings(value, Me)
            End Set
        End Property

        ''' <summary>
        ''' This will return the settings object as a dynamic expando object that you can review and edit.  If you
        ''' want your settings object casted to a specific type, use the GetSettings function.  Setting an object
        ''' to this location will also update the settings object for you as well
        ''' 
        ''' This will get the settings object for this report object.  Settings objects are unique based on
        ''' the RunReportID, LoggedInContact (either web or local), The active WebID or web site, a DashboardwidgetID and
        ''' optionaly a SettingsLocationID that you might choose to use.
        ''' 
        ''' So for a kWatch report delivered within kWatch - this would be unique based on RunReportID and contactID only as
        ''' webID, DashboardwidgetID and SettinglocationID are all nothing
        ''' </summary>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Function GetSettings(Of SettingObjectType)() As SettingObjectType Implements WebForm.GetSettings

            Return WebManagement.SettingsManagement.GetSettings(Of SettingObjectType)(Me)

        End Function

        ''' <summary>
        ''' This will save the settings object to the database
        ''' </summary>
        ''' <typeparam name="SettingObjectType"></typeparam>
        ''' <param name="Obj"></param>
        ''' <remarks></remarks>
        Public Sub SaveSettings(Of SettingObjectType)(Obj As SettingObjectType) Implements WebForm.SaveSettings

            WebManagement.SettingsManagement.SaveSettings(Obj, Me)

        End Sub

        ''' <summary>
        ''' This is a global property that if set - will be used as a reportProperties object by the dash-board component
        ''' You do not need to set this - and it is set if this report is used as 
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        <kWHTML.kWForms.reportProperty>
        Public Property DashboardWidgetID As Integer? Implements WebForm.DashboardWidgetID
        ''' <summary>
        ''' This will get the settings record for this report object.  Settings objects are created and unique based on
        ''' the RunReportID, LoggedInContact (either web or local), The active WebID or web site, a dash-board Widget ID and
        ''' optionaly a SettingsLocationID that you might choose to use.
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public ReadOnly Property SettingsRecord As defReportSetting Implements WebForm.SettingsRecord
            Get
                Return WebManagement.SettingsManagement.GetSettingsRecord(Me)
            End Get
        End Property


        ''' <summary>
        ''' This will return the guid that is used within the report object
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public ReadOnly Property ReportPropertiesGuid As Guid Implements WebForm.ReportPropertiesGuid
            Get
                Return WebManagement.SettingsManagement.getReportPropertiesGuid(Me)
            End Get
        End Property

        ''' <summary>
        ''' This wil return the report properties object for this report
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public ReadOnly Property ReportProperties As Object Implements WebForm.ReportProperties
            Get
                Return WebManagement.SettingsManagement.GetReportProperties(Me)
            End Get
        End Property
#End Region
#End Region
    End Class
    Public Class ClsIsNotReadyReasonTable
        Public Property ID As Integer
        Public Property Image
        Public Property ReferenceIcon
        Public Property Problem
        Public Property ReasonCode
        Public Property FurtherInfo
        Public Property PathLink


    End Class
End NameSpace
